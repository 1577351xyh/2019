$(document).ready(function(){var a={id:1,page:1,table:$(".pro_right table tbody"),selKey:{a:null,b:null,c:null,d:null,e:null,f:null,g:null,h:null,i:null,j:null,k:null,l:null,m:null,n:null,o:null,p:null,q:null,r:null,s:null,t:null},checkKey:{},tableHead:{},getProductType:function(){$.ajax({type:"get",url:"http://api.shikues.com/api/product/productType",data:{},success:function(d){var f=d.data;var g="";for(var c=0;c<f.length;c++){var e="";if(f[c].id==a.id){e="pro_active"}g='<li class="'+e+'" data-id="'+f[c].id+'"><a href="/categories/?id='+f[c].id+'">'+f[c].cn_name+"</a></li>";$("#pro_list").append(g)}},error:function(c){console.log(c)}})},getProductList:function(){var c={product_type_id:a.id,page:a.page,limit:15};c=Object.assign(c,a.checkKey);$.ajax({type:"get",url:"http://api.shikues.com/api/product/productList",data:c,success:function(f){var g=f.data;var h="";for(var e=0;e<g.length;e++){h="<tr>";for(var d in a.tableHead){h+="<td>"+g[e][d]||"</td>"}if(g[e].pdf){h+='<td><button class="pdf_btn" href="'+g[e].pdf+'">PDF</button></td>'}else{h+='<td><button class="pdf_btn" href="javascript:void(0)">PDF</button></td>'}h+="</tr>";a.table.append(h)}if(f.meta.total>0){a.setPage(f.meta.last_page);$("#loadtip").hide()}if(g.length==0){$("#loadtip").text("暂无数据")}},error:function(d){console.log(d)}})},getSelector:function(){a.table.append('<tr id="proSel"></tr>');$.ajax({type:"get",url:"http://api.shikues.com/api/product/screenList",data:{product_type_id:a.id},success:function(j){if(j.data.length>0){var e=JSON.parse(j.data[0].screen_content);console.log(e);var h="";for(var f=0;f<e.length;f++){h+="<td><div class='selbox'>";for(var l in e[f]){a.tableHead=Object.assign(a.tableHead,e[f]);var m="";if(l!="a"){for(var d=0;d<e[f][l].length;d++){var c=" ";if(a.selKey[l]){var g=a.selKey[l].split(",");if(g.indexOf(e[f][l][d])>-1){c="checked='true' "}}m+="<div><input "+c+'type="checkbox" value="'+e[f][l][d]+'" name="sel_'+l+'"/>'+e[f][l][d]+"</div>"}}h+=m+"</div></td>"}}console.log(a.tableHead);h+="<td></td>";if(!a.selKey.a){$("#proSel").html(h);a.selChange()}a.getProductList()}else{$("#loadtip").text("暂无数据")}},error:function(c){console.log(c)}})},selChange:function(){$("#proSel input").bind("change",function(f){var c={};for(var d in a.selKey){var g=a.getCheckBoxValueThree(d);if(g){c[d]=a.getCheckBoxValueThree(d)}}window.location.href="/categories/?id="+a.id+"&checkKey="+JSON.stringify(c)})},getCheckBoxValueThree:function(c){var e='#proSel input:checkbox[name="sel_'+c+'"]:checked';var d=$(e).map(function(){return $(this).val()}).get().join(",");return d},setPage:function(c){$(".pagination").bootstrapPaginator({bootstrapMajorVersion:3,currentPage:a.page,totalPages:c,itemTexts:function(d,e,f){switch(d){case"first":return"首页";case"prev":return"上一页";case"next":return"下一页";case"last":return"尾页";case"page":return e}},onPageClicked:function(g,d,f,e){a.page=e;if(Object.keys(a.checkKey).length>0){window.location.href="/categories/?id="+a.id+"&checkKey="+JSON.stringify(a.checkKey)+"&curpage="+e}else{window.location.href="/categories/?id="+a.id+"&curpage="+e}}})},setSearch:function(){var c=$("#searchInput");c.find("button").bind("click",function(){var e=c.find("input").val();if(e!=""){var d={a:e};window.location.href="/categories/?id="+a.id+"&checkKey="+JSON.stringify(d)}});c.find("input").val(a.selKey.a||"").keydown(function(f){var f=f||event,d=f.which||f.keyCode;if(d==13){c.find("button").trigger("click")}});$("#resetProBtn").bind("click",function(){c.find("input").val("");if(Object.keys(a.checkKey).length>0){window.location.href="/categories/?id="+a.id}})},init:function(){a.id=b("id")||1;a.page=b("curpage")||1;var c=b("checkKey");if(c){a.checkKey=JSON.parse(decodeURI(c));a.selKey=Object.assign(a.selKey,a.checkKey);console.log(a.selKey)}a.getProductType();a.setSearch();a.getSelector()}};function b(h){var d=document.location.toString();var g=d.split("?");if(g.length>1){var f=g[1].split("&");var c;for(var e=0;e<f.length;e++){c=f[e].split("=");if(c!=null&&c[0]==h){return c[1]}}return""}else{return""}}a.init()});